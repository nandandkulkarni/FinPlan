@page "/form-demo"
@using System.Globalization
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<PageTitle>Professional Form Design Showcase</PageTitle>

<style>
    /* General styling */
    .demo-container {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #333;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 0.5rem;
    }

    /* Card styling */
    .card-panel {
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: none;
        background: white;
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .card-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .card-panel.taxable {
            border-top: 4px solid #4299E1; /* Blue */
        }

        .card-panel.traditional {
            border-top: 4px solid #48BB78; /* Green */
        }

        .card-panel.roth {
            border-top: 4px solid #805AD5; /* Purple */
        }

    /* Wizard progress */
    .wizard-progress {
        display: flex;
        margin-bottom: 2rem;
        position: relative;
        z-index: 1;
    }

    .wizard-step {
        flex: 1;
        text-align: center;
        padding: 1rem 0.5rem;
        position: relative;
        opacity: 0.4;
    }

        .wizard-step.active {
            opacity: 1;
        }

        .wizard-step.completed {
            opacity: 0.8;
        }

    .step-indicator {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #CBD5E0;
        color: white;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 2;
    }

    .wizard-step.active .step-indicator {
        background: #6D5DFC;
        box-shadow: 0 4px 12px rgba(109,93,252,0.3);
    }

    .wizard-step.completed .step-indicator {
        background: #38A169;
    }

    .wizard-step-label {
        font-size: 0.85rem;
        font-weight: 600;
    }

    .wizard-progress:before {
        content: '';
        position: absolute;
        top: 18px;
        left: 0;
        right: 0;
        height: 2px;
        background: #E2E8F0;
        z-index: 0;
    }

    /* Fancy Inputs */
    .input-with-icon {
        position: relative;
    }

        .input-with-icon .form-control {
            padding-left: 2.5rem;
        }

        .input-with-icon i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #718096;
        }

    .currency-input {
        font-variant-numeric: tabular-nums;
        font-weight: 500;
    }

    /* Slider styling */
    .slider-container {
        margin: 1.5rem 0;
    }

    .range-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 10px;
        background: #E2E8F0;
        outline: none;
    }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6D5DFC;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(109,93,252,0.3);
            transition: transform 0.2s;
        }

            .range-slider::-webkit-slider-thumb:hover {
                transform: scale(1.1);
            }

    .slider-value {
        text-align: center;
        font-weight: 600;
        font-size: 1.25rem;
        margin-top: 0.5rem;
        font-variant-numeric: tabular-nums;
    }

    /* Mini-charts */
    .mini-chart {
        height: 60px;
        width: 100%;
        position: relative;
        margin-top: 1rem;
    }

    .chart-bar {
        position: absolute;
        bottom: 0;
        width: 8px;
        background: #6D5DFC;
        border-radius: 4px 4px 0 0;
        transition: height 0.5s;
    }

        .chart-bar.taxable {
            background: #4299E1;
        }

        .chart-bar.traditional {
            background: #48BB78;
        }

        .chart-bar.roth {
            background: #805AD5;
        }

    /* Floating summary panel */
    .floating-summary {
        position: sticky;
        top: 20px;
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        border-left: 4px solid #6D5DFC;
    }

    .summary-value {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: 0.25rem;
        font-variant-numeric: tabular-nums;
    }

    .summary-label {
        font-size: 0.85rem;
        color: #718096;
    }

    /* Validation styles */
    .validation-indicator {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
    }

        .validation-indicator.valid {
            color: #38A169;
        }

        .validation-indicator.warning {
            color: #ED8936;
        }

        .validation-indicator.invalid {
            color: #E53E3E;
        }

    /* Tooltips and popups */
    .enhanced-tooltip {
        background-color: #EBF5FF;
        border: 1px solid #BEDAFF;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        position: relative;
        line-height: 1.5;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

        .enhanced-tooltip img {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

    /* Comparison indicators */
    .comparison-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        margin-left: 0.5rem;
    }

        .comparison-indicator.above {
            background-color: rgba(56, 161, 105, 0.1);
            color: #38A169;
        }

        .comparison-indicator.below {
            background-color: rgba(229, 62, 62, 0.1);
            color: #E53E3E;
        }

        .comparison-indicator.average {
            background-color: rgba(237, 137, 54, 0.1);
            color: #ED8936;
        }

    /* Timeline visualization */
    .timeline {
        position: relative;
        height: 60px;
        margin: 2rem 0;
    }

    .timeline-line {
        position: absolute;
        height: 4px;
        top: 28px;
        left: 0;
        right: 0;
        background: #E2E8F0;
    }

    .timeline-marker {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: white;
        border: 2px solid #6D5DFC;
        top: 20px;
        transform: translateX(-50%);
        z-index: 1;
    }

        .timeline-marker.current {
            background: #6D5DFC;
        }

        .timeline-marker.retirement {
            background: #ED8936;
            border-color: #ED8936;
        }

    .timeline-label {
        position: absolute;
        top: 45px;
        transform: translateX(-50%);
        font-size: 0.75rem;
        color: #718096;
        font-weight: 600;
        white-space: nowrap;
    }

    /* Toggle switch for advanced features */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #E2E8F0;
        transition: .4s;
        border-radius: 34px;
    }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

    input:checked + .toggle-slider {
        background-color: #6D5DFC;
    }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

    /* Media queries for responsiveness */
    @@media (max-width: 768px) {
        .demo-container

    {
        padding: 1rem;
    }

    .card-panel {
        padding: 1rem;
    }

    .wizard-progress {
        flex-direction: column;
        margin-bottom: 1rem;
    }

    .wizard-step {
        display: flex;
        align-items: center;
        text-align: left;
        padding: 0.5rem;
    }

    .step-indicator {
        margin-bottom: 0;
        margin-right: 0.5rem;
    }

    .wizard-progress:before {
        display: none;
    }

    .floating-summary {
        position: static;
    }

    }
</style>

<div class="demo-container">
    <h1 class="mb-4">Professional Form Design Demo</h1>
    <p class="lead mb-5">
        This showcase demonstrates modern, professional form design techniques for financial planning applications.
    </p>

    <!-- Progress Visualization Section -->
    <div class="section-title">Step Progress Visualization</div>
    <div class="card-panel mb-4">
        <div class="wizard-progress">
            <div class="wizard-step completed">
                <div class="step-indicator">
                    <i class="bi bi-check"></i>
                </div>
                <div class="wizard-step-label">Personal Info</div>
            </div>
            <div class="wizard-step active">
                <div class="step-indicator">2</div>
                <div class="wizard-step-label">Account Balances</div>
            </div>
            <div class="wizard-step">
                <div class="step-indicator">3</div>
                <div class="wizard-step-label">Contributions</div>
            </div>
            <div class="wizard-step">
                <div class="step-indicator">4</div>
                <div class="wizard-step-label">Growth Rates</div>
            </div>
            <div class="wizard-step">
                <div class="step-indicator">5</div>
                <div class="wizard-step-label">Summary</div>
            </div>
        </div>
        <div class="text-center text-muted small">Completion: 40%</div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <!-- Color-Coded Account Cards -->
            <div class="section-title">Color-Coded Account Cards</div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card-panel taxable">
                        <h5><i class="bi bi-wallet2 me-2"></i>Taxable</h5>
                        <div class="input-with-icon mb-3">
                            <i class="bi bi-currency-dollar"></i>
                            <input type="text" class="form-control currency-input" value="125,000" />
                        </div>
                        <div class="d-flex justify-content-between small text-muted">
                            <span>Available Now</span>
                            <span>No Tax Advantages</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card-panel traditional">
                        <h5><i class="bi bi-piggy-bank me-2"></i>Traditional</h5>
                        <div class="input-with-icon mb-3">
                            <i class="bi bi-currency-dollar"></i>
                            <input type="text" class="form-control currency-input" value="250,000" />
                        </div>
                        <div class="d-flex justify-content-between small text-muted">
                            <span>Tax-Deferred</span>
                            <span>401(k), IRA</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card-panel roth">
                        <h5><i class="bi bi-safe me-2"></i>Roth</h5>
                        <div class="input-with-icon mb-3">
                            <i class="bi bi-currency-dollar"></i>
                            <input type="text" class="form-control currency-input" value="75,000" />
                        </div>
                        <div class="d-flex justify-content-between small text-muted">
                            <span>Tax-Free Growth</span>
                            <span>Roth IRA, Roth 401(k)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slider Inputs -->
            <div class="section-title">Slider Inputs with Real-Time Feedback</div>
            <div class="card-panel mb-4">
                <h5>Retirement Age</h5>
                <div class="slider-container">
                    <input type="range" min="55" max="75" value="65" class="range-slider" id="retirementSlider" @oninput="UpdateRetirementAge" />
                    <div class="slider-value">@retirementAge years old</div>
                </div>

                <!-- Timeline Visualization -->
                <div class="timeline">
                    <div class="timeline-line"></div>
                    <div class="timeline-marker current" style="left: 0%"></div>
                    <div class="timeline-label" style="left: 0%">Now (35)</div>

                    <div class="timeline-marker retirement" style="left: @timelinePosition%"></div>
                    <div class="timeline-label" style="left: @timelinePosition%">Retire (@retirementAge)</div>

                    <div class="timeline-marker" style="left: 100%"></div>
                    <div class="timeline-label" style="left: 100%">90</div>
                </div>
            </div>

            <!-- Input with Smart Defaults and Validation -->
            <div class="section-title">Smart Defaults and Validation</div>
            <div class="card-panel mb-4">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">
                            Monthly Contribution
                            <span class="bi bi-info-circle info-icon" @onclick="() => showContributionTooltip = !showContributionTooltip" tabindex="0" title="Click for more info"></span>
                        </label>
                        @if (showContributionTooltip)
                        {
                            <div class="enhanced-tooltip">
                                <strong>Monthly Contribution:</strong> The amount you save each month toward retirement.
                                <div class="mt-2">
                                    <strong>Recommendations:</strong>
                                    <ul class="mb-2">
                                        <li>15-20% of gross income is ideal</li>
                                        <li>Include employer matches in this total</li>
                                    </ul>
                                </div>
                                <img src="https://via.placeholder.com/400x150?text=Contribution+Graph" alt="Sample contribution graph" />
                                <span class="float-end" style="cursor:pointer;" @onclick="() => showContributionTooltip = false" title="Close">
                                    <span class="bi bi-x-lg"></span>
                                </span>
                            </div>
                        }
                        <div class="input-with-icon">
                            <i class="bi bi-currency-dollar"></i>
                            <input type="text" class="form-control currency-input" value="1,500"
                                   @oninput="UpdateContribution" />
                            <div class="validation-indicator valid">
                                <i class="bi bi-check-circle"></i>
                            </div>
                        </div>
                        <div class="text-end mt-1">
                            <span class="comparison-indicator above">
                                <i class="bi bi-arrow-up-short"></i> 15% above average
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Growth Rate (%)</label>
                        <div class="input-with-icon">
                            <i class="bi bi-graph-up"></i>
                            <input type="text" class="form-control" value="7.5" @oninput="UpdateGrowthRate" />
                            <div class="validation-indicator warning">
                                <i class="bi bi-exclamation-circle"></i>
                            </div>
                        </div>
                        <div class="text-end mt-1">
                            <span class="comparison-indicator average">
                                <i class="bi bi-dash"></i> Average
                            </span>
                        </div>
                    </div>
                </div>
                <!-- Smart defaults buttons -->
                <div class="mt-3">
                    <button class="btn btn-sm btn-outline-secondary me-2" @onclick="ApplyConservativeDefaults">
                        <i class="bi bi-shield-check me-1"></i> Conservative (6%)
                    </button>
                    <button class="btn btn-sm btn-outline-secondary me-2" @onclick="ApplyBalancedDefaults">
                        <i class="bi bi-layers me-1"></i> Balanced (7.5%)
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" @onclick="ApplyAggressiveDefaults">
                        <i class="bi bi-graph-up-arrow me-1"></i> Aggressive (9%)
                    </button>
                </div>
            </div>

            <!-- Mini Charts Section -->
            <div class="section-title">Interactive Mini Charts</div>
            <div class="card-panel mb-4">
                <h5>Account Growth Projection</h5>
                <div class="row mb-3">
                    <div class="col-4 text-center">
                        <div class="mini-chart">
                            @for (int i = 0; i < 12; i++)
                            {
                                <div class="chart-bar taxable"
                                     style="left: @(i * 8 + 4)px; height: @GetTaxableBarHeight(i)px;"></div>
                            }
                        </div>
                        <div class="small text-muted">Taxable</div>
                        <div class="fw-bold">$250,000</div>
                    </div>
                    <div class="col-4 text-center">
                        <div class="mini-chart">
                            @for (int i = 0; i < 12; i++)
                            {
                                <div class="chart-bar traditional"
                                     style="left: @(i * 8 + 4)px; height: @GetTraditionalBarHeight(i)px;"></div>
                            }
                        </div>
                        <div class="small text-muted">Traditional</div>
                        <div class="fw-bold">$500,000</div>
                    </div>
                    <div class="col-4 text-center">
                        <div class="mini-chart">
                            @for (int i = 0; i < 12; i++)
                            {
                                <div class="chart-bar roth"
                                     style="left: @(i * 8 + 4)px; height: @GetRothBarHeight(i)px;"></div>
                            }
                        </div>
                        <div class="small text-muted">Roth</div>
                        <div class="fw-bold">$320,000</div>
                    </div>
                </div>
                <div class="text-center text-muted small">
                    Each bar represents 5 years of growth based on your inputs
                </div>
            </div>

            <!-- Advanced Options Toggle -->
            <div class="section-title">Advanced Options Toggle</div>
            <div class="card-panel mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Show Advanced Options</h5>
                    <label class="toggle-switch">
                        <input type="checkbox" @onchange="ToggleAdvancedOptions">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                @if (showAdvancedOptions)
                {
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tax-Loss Harvesting</label>
                            <select class="form-select">
                                <option>None</option>
                                <option>Conservative</option>
                                <option>Aggressive</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Rebalancing Frequency</label>
                            <select class="form-select">
                                <option>Annually</option>
                                <option>Semi-Annually</option>
                                <option>Quarterly</option>
                                <option>Monthly</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Withdrawal Strategy</label>
                            <select class="form-select">
                                <option>Proportional</option>
                                <option>Tax-Efficient</option>
                                <option>Traditional First</option>
                                <option>Roth Last</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Inflation Adjustment</label>
                            <select class="form-select">
                                <option>Standard (2-3%)</option>
                                <option>Low (1-2%)</option>
                                <option>High (3-4%)</option>
                                <option>Custom</option>
                            </select>
                        </div>
                    </div>
                }
                else
                {
                    <div class="text-muted">
                        Enable advanced options to configure tax-loss harvesting, rebalancing, withdrawal strategies, and inflation settings.
                    </div>
                }
            </div>
        </div>

        <!-- Floating Summary Column -->
        <div class="col-md-4">
            <div class="floating-summary">
                <h4>Retirement Projection</h4>
                <div class="mb-4">
                    <div class="summary-value text-primary">$1,070,000</div>
                    <div class="summary-label">Projected Retirement Balance</div>
                </div>
                <div class="mb-4">
                    <div class="summary-value text-success">$43,000</div>
                    <div class="summary-label">Annual Retirement Income</div>
                </div>
                <div class="mb-4">
                    <div class="summary-value text-info">@timelinePosition%</div>
                    <div class="summary-label">Chance of Success</div>
                </div>

                <div class="alert alert-success">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    You're on track for a comfortable retirement!
                </div>

                <div class="card bg-light p-3 mb-3">
                    <h6>What This Means</h6>
                    <p class="mb-0 small">
                        Based on your inputs, you're projected to have enough savings to withdraw about $43,000 annually
                        (in today's dollars) during retirement, which should provide a comfortable lifestyle.
                    </p>
                </div>

                <button class="btn btn-primary w-100">
                    <i class="bi bi-file-earmark-pdf me-2"></i>
                    Download Detailed Report
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    private int retirementAge = 65;
    private double timelinePosition = 55;
    private decimal contributionAmount = 1500;
    private decimal growthRate = 7.5m;
    private bool showContributionTooltip = false;
    private bool showAdvancedOptions = false;

    private void UpdateRetirementAge(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int value))
        {
            retirementAge = value;
            // Calculate position on timeline (from 35 to 90)
            timelinePosition = (value - 35) * 100.0 / (90 - 35);
        }
    }

    private void UpdateContribution(ChangeEventArgs e)
    {
        if (e.Value is string stringValue && !string.IsNullOrEmpty(stringValue))
        {
            string cleanValue = new string(stringValue.Where(c => char.IsDigit(c) || c == '.').ToArray());

            if (decimal.TryParse(cleanValue, out decimal value))
            {
                contributionAmount = value;
            }
        }
    }

    private void UpdateGrowthRate(ChangeEventArgs e)
    {
        if (decimal.TryParse(e.Value?.ToString(), out decimal value))
        {
            growthRate = value;
        }
    }

    private void ApplyConservativeDefaults()
    {
        growthRate = 6.0m;
    }

    private void ApplyBalancedDefaults()
    {
        growthRate = 7.5m;
    }

    private void ApplyAggressiveDefaults()
    {
        growthRate = 9.0m;
    }

    private void ToggleAdvancedOptions(ChangeEventArgs e)
    {
        if (e.Value is bool boolValue)
        {
            showAdvancedOptions = boolValue;
        }
    }

    // Methods to calculate heights for mini chart bars
    private int GetTaxableBarHeight(int index)
    {
        // Simulate compound growth
        return (int)(10 + index * 3.5);
    }

    private int GetTraditionalBarHeight(int index)
    {
        // Simulate compound growth
        return (int)(15 + index * 4);
    }

    private int GetRothBarHeight(int index)
    {
        // Simulate compound growth
        return (int)(8 + index * 4.5);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("console.log", "Professional Form Demo Loaded");
        }
    }
}