@namespace FinPlan.Web.Components.Shared
@using FinPlan.Shared.Models
@using FinPlan.Shared.Models.Savings
@using System.Globalization

<div class="savings-mini" role="region" aria-label="@Title">
    <div class="card small-card">
        <div class="card-body p-2">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="small-title">@Title</strong>
                <small class="text-muted small">Final balances</small>
            </div>

            <div class="user-block mb-2">
                <div class="small-label">You</div>
                <ul class="mini-list mb-1">
                    <li class="row-item">Post?Tax: <strong>@Format(YouTaxable)</strong></li>
                    <li class="row-item">Traditional: <strong>@Format(YouTraditional)</strong></li>
                    <li class="row-item">Roth: <strong>@Format(YouRoth)</strong></li>
                    <li class="row-item user-total">Total: <strong>@Format(YouTotal)</strong></li>
                </ul>
            </div>

            @if (HasPartner)
            {
                <div class="partner-block mb-2">
                    <div class="small-label">Partner</div>
                    <ul class="mini-list mb-1">
                        <li class="row-item">Post?Tax: <strong>@Format(PartnerTaxable)</strong></li>
                        <li class="row-item">Traditional: <strong>@Format(PartnerTraditional)</strong></li>
                        <li class="row-item">Roth: <strong>@Format(PartnerRoth)</strong></li>
                        <li class="row-item user-total">Total: <strong>@Format(PartnerTotal)</strong></li>
                    </ul>
                </div>
            }

            <div class="grand-block mt-2">
                <div class="small-label">Combined (per bucket)</div>
                <ul class="mini-list mb-0">
                    <li class="row-item">Post?Tax: <strong>@Format(GrandTaxable)</strong></li>
                    <li class="row-item">Traditional: <strong>@Format(GrandTraditional)</strong></li>
                    <li class="row-item">Roth: <strong>@Format(GrandRoth)</strong></li>
                </ul>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public SavingsResults? YouResults { get; set; }

    [Parameter]
    public SavingsResults? PartnerResults { get; set; }

    [Parameter]
    public string Title { get; set; } = "Savings";

    private decimal YouTaxable => YouResults?.TaxableBalance ?? 0m;
    private decimal YouTraditional => YouResults?.TaxDeferredBalance ?? 0m;
    private decimal YouRoth => YouResults?.RothBalance ?? 0m;
    private decimal YouTotal => YouTaxable + YouTraditional + YouRoth;

    private decimal PartnerTaxable => PartnerResults?.TaxableBalance ?? 0m;
    private decimal PartnerTraditional => PartnerResults?.TaxDeferredBalance ?? 0m;
    private decimal PartnerRoth => PartnerResults?.RothBalance ?? 0m;
    private decimal PartnerTotal => PartnerTaxable + PartnerTraditional + PartnerRoth;

    private bool HasPartner => PartnerResults != null && (PartnerTaxable != 0m || PartnerTraditional != 0m || PartnerRoth != 0m);

    private decimal GrandTaxable => YouTaxable + PartnerTaxable;
    private decimal GrandTraditional => YouTraditional + PartnerTraditional;
    private decimal GrandRoth => YouRoth + PartnerRoth;

    private string Format(decimal v) => v.ToString("C0", CultureInfo.CurrentCulture);
}

<style>
.savings-mini { width: 180px; }
.savings-mini .small-card { border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.small-title { font-size: 0.95rem; }
.small-label { font-size: 0.80rem; color: #444; margin-bottom: 6px; }
.mini-list { margin: 0; padding-left: 0.9rem; font-size: 0.82rem; }
.mini-list li { line-height: 1.1; list-style: disc; padding: 6px 8px; border-radius: 6px; }
.mini-list li.row-item:nth-child(odd) { background: rgba(0,0,0,0.02); }
.mini-list li.row-item:nth-child(even) { background: rgba(0,0,0,0.00); }
.user-total { margin-top: 6px; font-weight: 700; }

/* Different backgrounds per section */
.user-block { background: linear-gradient(90deg, rgba(237,246,255,1) 0%, rgba(245,251,255,1) 100%); padding:8px; border-radius:6px; }
.partner-block { background: linear-gradient(90deg, rgba(240,255,244,1) 0%, rgba(247,255,250,1) 100%); padding:8px; border-radius:6px; }
.grand-block { background: linear-gradient(90deg, rgba(255,250,240,1) 0%, rgba(255,253,243,1) 100%); padding:8px; border-radius:6px; }

/* Highlight totals */
.user-total { background: transparent; }

@@media (max-width: 992px) { .savings-mini { display:none !important; } }
</style>