@page "/survey-retirement-income-planner"
@using FinPlan.Web.Components.Models
@using FinPlan.Web.Components.Survey
@using Microsoft.AspNetCore.Components
@using FinPlan.Web.Services
@using Microsoft.JSInterop
@inject IHttpClientFactory HttpClientFactory
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation
@inject FinPlan.Web.Services.UserGuidService UserGuidService
@inject IConfiguration Configuration

@* <PageTitle>Retirement Income Planner - Survey</PageTitle>
 *@

<div class="alert alert-info" style="margin-bottom:18px; border-radius:10px; font-size:1.05rem;">
    <strong>Thank you for trying the Retirement Income Planner</strong><br />
    We truly appreciate you taking the time to share your feedback. There are many questions below, but please feel free to answer only those you wishï¿½every response helps us improve. No personal information is collected
</div>

<SurveyForm Questions="@questions" Title="Retirement Income Planner - Survey" SurveyType="RetirementPlanner"/>

@code {
    private List<SurveyQuestion> questions = new()
    {
        new SurveyQuestion("How easy was it to find advanced mode?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),
        // Data Entry
        new SurveyQuestion("How easy was it to enter your post-tax, traditional and Roth balances at retirement?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),
        new SurveyQuestion("How easy was it to set Social Security claim ages and benefits?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),

        // Results & Cards
        new SurveyQuestion("How useful were the retirement income projection charts (visuals)?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),
        new SurveyQuestion("How clear was the year-by-year breakdown of withdrawals and balances?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),
        new SurveyQuestion("How useful is the ability to view Range, Depletion, Shortfalll?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),

        // Yearly Projection Table Experience
new SurveyQuestion("How easy was it to understand the yearly projection table?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),
new SurveyQuestion("How useful was the ability to hide or show column groups in the projection table?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),
new SurveyQuestion("How clear were the tooltips and info icons for each column?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),

// Timeline & Milestones
new SurveyQuestion("How helpful were the timeline and milestone columns (Year, Your Age, Partner Age, Milestones) in tracking retirement events?", new List<string>{"Very Helpful","Helpful","Neutral","Not Helpful","Did Not Use"}),

// Retirement Equation
new SurveyQuestion("How clear was the calculation of 'Amount Needed' and 'Amount Withdrawn' for each year?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),

// Withdrawals for Cost Of Living
new SurveyQuestion("How useful was the breakdown of withdrawals by account type (Taxable, Traditional, Roth) for covering living expenses?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),

// Income and Growth
new SurveyQuestion("How easy was it to interpret the income sources (Social Security, Reverse Mortgage, Growth) for each year?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),
new SurveyQuestion("How useful was the 'Total Inflow' column in understanding your annual income?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),

// Ending Balances
new SurveyQuestion("How clear were the ending balance columns for each account type and the total?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),

// Tax Paid (Income Breakdown)
new SurveyQuestion("How useful was the tax paid breakdown for growth and income?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),

// Tax Paid (Traditional Breakdown)
new SurveyQuestion("How clear was the tax paid breakdown for traditional account withdrawals?", new List<string>{"Very Clear","Clear","Neutral","Unclear","Very Unclear"}),

// Total Withdrawals
new SurveyQuestion("How useful was the total withdrawals breakdown by account type?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),

// Interaction & Usability
new SurveyQuestion("How easy was it to scroll, navigate, and view all years in the projection table?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),


// Open feedback
new SurveyQuestion("Did you encounter any confusion or difficulty with the column group toggles or the grid layout?"),
new SurveyQuestion("Are there any columns or data you wish were included or excluded in the yearly projection?"),

        // Warnings & Performance
        new SurveyQuestion("How useful were warnings or alerts (e.g., money may run out) in guiding decisions?", new List<string>{"Very Useful","Useful","Neutral","Not Useful","Did Not Use"}),
        new SurveyQuestion("How easy was it to change assumptions and re-run scenarios?", new List<string>{"Very Easy","Easy","Neutral","Difficult","Very Difficult"}),
        new SurveyQuestion("How would you rate the app's speed and performance when recalculating results?", new List<string>{"Excellent","Good","Average","Poor","Very Poor"}),

        // Satisfaction
        new SurveyQuestion("How likely are you to recommend the Retirement Income Planner to a colleague or friend?", new List<string>{"Very Likely","Likely","Neutral","Unlikely","Very Unlikely"}),
        new SurveyQuestion("Overall, how satisfied are you with the Retirement Income Planner?", new List<string>{"Very Satisfied","Satisfied","Neutral","Dissatisfied","Very Dissatisfied"}),

        // Open Feedback
        new SurveyQuestion("What did you like most about the Retirement Income Planner?"),
        new SurveyQuestion("What part of the planner did you find most confusing or difficult to use?"),
        new SurveyQuestion("What additional features or improvements would you like to see?"),
        new SurveyQuestion("Did any results or calculations seem incorrect? Please describe any discrepancies or bugs."),
        new SurveyQuestion("Any other comments, suggestions or use-cases you'd like to share?")
    };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                var userGuid = await UserGuidService.GetOrCreateUserGuidAsync();
                var apiBaseUrl = Configuration["FinPlanSettings:ApiBaseUrlLocal"] ?? "https://localhost:7330";
                var client = HttpCustomClientService.CreateRetryClient(HttpClientFactory);
                var route = Navigation.ToBaseRelativePath(Navigation.Uri);
                string? ua = null;
                try { ua = await JSRuntime.InvokeAsync<string>("fpBrowserInfo.getUserAgent"); } catch { }
                var dto = new { Page = "Survey-Retire", Route = route, UserGuid = userGuid, UserAgent = ua };
                var json = System.Text.Json.JsonSerializer.Serialize(dto);
                using var content = new StringContent(json, System.Text.Encoding.UTF8, "application/json");
                await client.PostAsync($"{apiBaseUrl}/api/Tracking/pageview", content);
            }
            catch { }
        }
    }
}
